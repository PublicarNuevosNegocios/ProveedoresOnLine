@model MarketPlace.Models.Provider.ProviderViewModel
@{
    ViewBag.Title = "Proveedores OnLine - Consulta Individual";
    Layout = MVC.Desktop.Shared.Views._Layout;

    Model.RenderScripts = false;
}

@*ESTE ES EL ENVUELTO COMPLETO DE MENU LATERAL Y CONTENIDO*@
<div class="POMPProviderGreatWrapper">
    @*ESTE ES QUE TRAE EL PARCIAL QUE PINTA EL MENU LATERAL*@
    <div class="POMPProviderSideMenuWrapper">
        @Html.Partial(MVC.Desktop.Shared.Views._P_ProviderMenu, Model)
    </div>
    <div class="POMPProviderDataWrapper">
        <div>
            <form id="frmThirdKnowledgeUpsert"
                  method="post"
                  action="@(Url.Action
                    (MVC.ThirdKnowledge.ActionNames.TKThirdKnowledgeDetail,
                    MVC.ThirdKnowledge.Name,
                    new
                    {
                        QueryPublicId = Model.RelatedThidKnowledgeSearch.ThirdKnowledgeResult.Where(x => x.QueryPublicId != null).Select(x => x.QueryPublicId).DefaultIfEmpty(string.Empty).FirstOrDefault(),
                        InitDate = Model.RelatedThidKnowledgeSearch.InitDate.ToString("yyyy-MM-dd"),
                        EndDate = Model.RelatedThidKnowledgeSearch.EndDate.ToString("yyyy-MM-dd"),
                    }))">
                <button id="POMPButtonDownloadReports" type="submit" title="Descargar Reporte">Descargar Reporte</button>
                <input type="hidden" name="DownloadReport" value="true" />
            </form>
        </div>
        <div class="POMPSearchContainer">
            @*Return Buttom*@
            @if (!string.IsNullOrEmpty(Model.RelatedThidKnowledgeSearch.InitDate.ToString("yyyy-MM-dd")) && Model.RelatedThidKnowledgeSearch.InitDate.ToString("dd/MM/yyyy") != "01/01/0001" &&
                !string.IsNullOrEmpty(Model.RelatedThidKnowledgeSearch.EndDate.ToString("yyyy-MM-dd")) && Model.RelatedThidKnowledgeSearch.EndDate.ToString("dd/MM/yyyy") != "01/01/0001")
            {
                <a href="@(Url.RouteUrl
                              (MarketPlace.Models.General.Constants.C_Routes_Default,
                              new
                              {
                                  controller = MVC.ThirdKnowledge.Name,
                                  action = MVC.ThirdKnowledge.ActionNames.TKThirdKnowledgeSearch,
                                  InitDate = Model.RelatedThidKnowledgeSearch.InitDate.ToString("yyyy-MM-dd"),
                                  EndDate = Model.RelatedThidKnowledgeSearch.EndDate.ToString("yyyy-MM-dd"),
                                    }))">Regresar a la búsqueda</a>
            }
            else
            {
                <a href="@(Url.RouteUrl
                              (MarketPlace.Models.General.Constants.C_Routes_Default,
                              new
                              {
                                  controller = MVC.ThirdKnowledge.Name,
                                  action = MVC.ThirdKnowledge.ActionNames.TKThirdKnowledgeSearch,
                                    }))">Regresar a la búsqueda</a>
            }

            @if (Model.RelatedThidKnowledgeSearch != null &&
                    Model.RelatedThidKnowledgeSearch.ThirdKnowledgeResult != null &&
                    Model.RelatedThidKnowledgeSearch.ThirdKnowledgeResult.Count > 0)
            {
                foreach (var item in Model.RelatedThidKnowledgeSearch.ThirdKnowledgeResult)
                {

                    <span>@item.User</span>
                    <span>@item.CreateDate</span>
                    <span>@item.SearchType.ItemName</span>

                    <span>Consultas:</span>
                    <br />
                    <ul>
                        @foreach (var query in item.RelatedQueryInfoModel)
                        {
                            <li>
                                <div>
                                    <span>@query.Value</span>
                                </div>
                            </li>
                        }
                    </ul>
                }
            }
        </div>
    </div>
</div>

@{
    Model.RenderScripts = true;
}
@section inlinescripts
{
    @Html.Partial(MVC.Desktop.Shared.Views._P_ProviderMenu, Model)

    <script type="text/javascript">
        $(document).ready(function () {

        });
    </script>
}